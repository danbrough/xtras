package = org.danbrough.ssh2.cinterops
headers = libssh2.h  libssh2_publickey.h  libssh2_sftp.h
linkerOpts = -lssh2

### XTRAS: generated paths from the cinteropsTargetWriter

compilerOpts.android_arm32 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeArm32/1.11.0/include
linkerOpts.android_arm32 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeArm32/1.11.0/lib
libraryPaths.android_arm32 =  /home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeArm32/1.11.0/lib

compilerOpts.android_arm64 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeArm64/1.11.0/include
linkerOpts.android_arm64 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeArm64/1.11.0/lib
libraryPaths.android_arm64 =  /home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeArm64/1.11.0/lib

compilerOpts.android_x64 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeX64/1.11.0/include
linkerOpts.android_x64 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeX64/1.11.0/lib
libraryPaths.android_x64 =  /home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeX64/1.11.0/lib

compilerOpts.android_x86 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeX86/1.11.0/include
linkerOpts.android_x86 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeX86/1.11.0/lib
libraryPaths.android_x86 =  /home/dan/workspace/xtras/xtras/libs/ssh2/androidNativeX86/1.11.0/lib

compilerOpts.linux_arm64 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/linuxArm64/1.11.0/include
linkerOpts.linux_arm64 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/linuxArm64/1.11.0/lib
libraryPaths.linux_arm64 =  /home/dan/workspace/xtras/xtras/libs/ssh2/linuxArm64/1.11.0/lib

compilerOpts.linux_x64 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/linuxX64/1.11.0/include
linkerOpts.linux_x64 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/linuxX64/1.11.0/lib
libraryPaths.linux_x64 =  /home/dan/workspace/xtras/xtras/libs/ssh2/linuxX64/1.11.0/lib

compilerOpts.mingw_x64 =  -I/home/dan/workspace/xtras/xtras/libs/ssh2/mingwX64/1.11.0/include
linkerOpts.mingw_x64 = -L/home/dan/workspace/xtras/xtras/libs/ssh2/mingwX64/1.11.0/lib
libraryPaths.mingw_x64 =  /home/dan/workspace/xtras/xtras/libs/ssh2/mingwX64/1.11.0/lib

---
  #include<libssh2.h>

static int waitsocket(libssh2_socket_t socket_fd, LIBSSH2_SESSION *session)
{
    struct timeval timeout;
    int rc;
    fd_set fd;
    fd_set *writefd = NULL;
    fd_set *readfd = NULL;
    int dir;

    timeout.tv_sec = 10;
    timeout.tv_usec = 0;

    FD_ZERO(&fd);

    FD_SET(socket_fd, &fd);

    /* now make sure we wait in the correct direction */
    dir = libssh2_session_block_directions(session);

    if(dir & LIBSSH2_SESSION_BLOCK_INBOUND)
        readfd = &fd;

    if(dir & LIBSSH2_SESSION_BLOCK_OUTBOUND)
        writefd = &fd;

    rc = select((int)(socket_fd + 1), readfd, writefd, NULL, &timeout);

    return rc;
}
